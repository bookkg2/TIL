## instagram

- 댓글(commnet) : model, url

  - database relation(1:N)
  - 1에 대한 정보를 가지고 있음 = ID

- 이미지 업로드, 좋아요, 해시태그

  - database relation(M:N)

- {% %} : 파이썬 '로직'

- fontawesome : icon 및 폰트 가져오기 사이트 

  https://fontawesome.com/icons/comment-dots?style=solid

- Ajax 는 비동기성을 주기위한 과정 

  - 비동기성은 쉽게 일은 남에게 주고 Callback 결과만 받는다. (즉 일을 지속하면 다른 일은 다른곳에 맡길 수 있다.)

- settings.py

  - Project 이름 : instagram
  - app 이름: article
  - powershell에 python manage.py startapp article ->앱 생성
  -  settings.py 안에 INSTALLED_APPS에 앱 등록

  ```python
  """
  Django settings for instagram project.
  
  Generated by 'django-admin startproject' using Django 2.2.7.
  
  For more information on this file, see
  https://docs.djangoproject.com/en/2.2/topics/settings/
  
  For the full list of settings and their values, see
  https://docs.djangoproject.com/en/2.2/ref/settings/
  """
  
  import os
  
  # Build paths inside the project like this: os.path.join(BASE_DIR, ...)
  BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
  
  
  # Quick-start development settings - unsuitable for production
  # See https://docs.djangoproject.com/en/2.2/howto/deployment/checklist/
  
  # SECURITY WARNING: keep the secret key used in production secret!
  SECRET_KEY = '@*5vfj*c3@0#ctn_jiw5d3pirxq@hva#7w=x$6-*!r+$chinj5'
  
  # SECURITY WARNING: don't run with debug turned on in production!
  DEBUG = True
  
  ALLOWED_HOSTS = []
  
  
  # Application definition
  
  INSTALLED_APPS = [
      'article',
      'django.contrib.admin',
      'django.contrib.auth',
      'django.contrib.contenttypes',
      'django.contrib.sessions',
      'django.contrib.messages',
      'django.contrib.staticfiles',
  ]
  
  MIDDLEWARE = [
      'django.middleware.security.SecurityMiddleware',
      'django.contrib.sessions.middleware.SessionMiddleware',
      'django.middleware.common.CommonMiddleware',
      'django.middleware.csrf.CsrfViewMiddleware',
      'django.contrib.auth.middleware.AuthenticationMiddleware',
      'django.contrib.messages.middleware.MessageMiddleware',
      'django.middleware.clickjacking.XFrameOptionsMiddleware',
  ]
  
  ROOT_URLCONF = 'instagram.urls'
  
  TEMPLATES = [
      {
          'BACKEND': 'django.template.backends.django.DjangoTemplates',
          'DIRS': [],
          'APP_DIRS': True,
          'OPTIONS': {
              'context_processors': [
                  'django.template.context_processors.debug',
                  'django.template.context_processors.request',
                  'django.contrib.auth.context_processors.auth',
                  'django.contrib.messages.context_processors.messages',
              ],
          },
      },
  ]
  
  WSGI_APPLICATION = 'instagram.wsgi.application'
  
  
  # Database
  # https://docs.djangoproject.com/en/2.2/ref/settings/#databases
  
  DATABASES = {
      'default': {
          'ENGINE': 'django.db.backends.sqlite3',
          'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
      }
  }
  
  
  # Password validation
  # https://docs.djangoproject.com/en/2.2/ref/settings/#auth-password-validators
  
  AUTH_PASSWORD_VALIDATORS = [
      {
          'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
      },
      {
          'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
      },
      {
          'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
      },
      {
          'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
      },
  ]
  
  
  # Internationalization
  # https://docs.djangoproject.com/en/2.2/topics/i18n/
  
  LANGUAGE_CODE = 'ko'
  
  TIME_ZONE = 'Asia/seoul'
  
  USE_I18N = True
  
  USE_L10N = True
  
  USE_TZ = False
  
  
  # Static files (CSS, JavaScript, Images)
  # https://docs.djangoproject.com/en/2.2/howto/static-files/
  
  STATIC_URL = '/static/'
  
  ```

- instagram 파일 전체 url 경로에 경로 설정 

  instagram -> urls.py (include 사용에서 Url 경로 붙이기)

  ```python
  """instagram URL Configuration
  
  The `urlpatterns` list routes URLs to views. For more information please see:
      https://docs.djangoproject.com/en/2.2/topics/http/urls/
  Examples:
  Function views
      1. Add an import:  from my_app import views
      2. Add a URL to urlpatterns:  path('', views.home, name='home')
  Class-based views
      1. Add an import:  from other_app.views import Home
      2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
  Including another URLconf
      1. Import the include() function: from django.urls import include, path
      2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
  """
  from django.contrib import admin
  from django.urls import path, include
  
  urlpatterns = [
      path('admin/', admin.site.urls),
      path('insta/', include ('article.urls')),
  ]
  
  ```

- 데이터 생성

  models.py

  ```python
  from django.db import models
  
  # Create your models here.
  
  class Article(models.Model):
      contents = models.TextField()
      created_at = models.DateTimeField(auto_now_add = True)
      updated_at = models.DateTimeField(auto_now = True)
  
      def comments(self):
          #외래 테이블에서 Comment와 Article id 엮기.
          #이게 아니면 html에 article.comment_set.all해서 불러와야한다. 
          return Comment.objects.filter(article_id = self.id)
  
  #댓글
  #article의 ID를 물고있어야함(foreignkey 설정)
  #(참고, 조건 <CASCADE 는 Article이 삭제되면 연쇄적으로 삭제>)
  class Comment(models.Model):
      contents = models.TextField()
      created_at = models.DateTimeField(auto_now_add = True)
      updated_at = models.DateTimeField(auto_now = True)
      article = models.ForeignKey(Article, on_delete=models.CASCADE)
  
  ```

  - 생성 후 python manage.py makemigration -> python manage.py migrate

- views.py

  ```python
  from django.shortcuts import render,redirect
  from .models import Article, Comment
  
  # Create your views here.
  
  def index(request):
      if request.method =="POST":
          article = Article()
          article.contents = request.POST["contents"]
          article.save()
          return redirect('articles')
      else:
      #redirect는 다른 메서드로 보내겠다. 
      #render는 처음에는 무조건 request 하고 이동할 페이지 
          #reverse 는 order 기준으로 뒤집는다.
          articles = Article.objects.all().order_by("created_at").reverse()
          context = {
              'articles' : articles
          }
          return render(request, 'index.html', context)
  def edit(request, article_id):
      article = Article.objects.get(id=article_id)
      if request.method=="POST":
          article.contents = request.POST["contents"]
          article.save()
          return redirect('articles')
      else:
  
          context = {
              'article':article
          }
          return render(request,'article/edit.html', context)
  
  def delete(requst, article_id):
      article = Article.objects.get(id = article_id)
      article.delete()
      return redirect('articles')
      
  def comments(request):
      if request.method =="POST":
          contents = request.POST["contents"]
          article_id= request.POST["article_id"]
          comment = Comment()
          comment.contents = contents
          comment.article_id = article_id
          comment.save()
          return redirect('articles')
  
  
  
  
  def delete_comment(request,comment_id):
      comment = Comment.objects.get(id = comment_id)
      comment.delete()
      return redirect('articles')
  
  def edit_comment(request, comment_id):
      comment = Comment.objects.get(id=comment_id)
      if request.method =="POST":
          comment.contents = request.POST["contents"]
          comment.save()
          return redirect('articles')
  
      else:
      
          context = {
          'comment':comment
           }
  
      return render(request, 'comment/edit.html', context)
  
  
  ```

- 앱 urls.py 생성 후 

  ```python
  from django.urls import path
  from . import views as article_views
  
  urlpatterns = [
      path('',article_views.index,name="articles"),
      path('comments/',article_views.comments,name="comments"),
      path('articles/<int:article_id>/edit/', article_views.edit, name="edit"),
      path('articles/<int:article_id>/delete/', article_views.delete, name="delete"),
      path('comments/<int:comment_id>/delete/', article_views.delete_comment,name="delete_comment"),
      path('comments/<int:comment_id>/edit/', article_views.edit_comment, name="edit_comment")
  ]
  ```

- article -> edit.html

  ```html
  {% extends 'base.html' %}
  
  {% block content %}
  <div class="container">
      <div class="card">
          <form action="{% url 'edit' article.id %}" method="POST">
              <input type="hidden" name="csrfmiddlewaretoken" value="{{csrf_token}}">
              <div class="card-body">
                  <textarea name="contents" class="form-control" rows="5">{{article.contents}}</textarea>
              </div>
              <div class="card-footer text-right">
                  <input type="submit" class="btn btn-success" value="작성하기">
              </div>
          </form>
      </div>
  
  </div>
  {% endblock %}
  ```

  comment -> edit.html

  ```html
  {% extends 'base.html' %}
  
  {% block content %}
  <div class="container">
      <div class="card">
          <form action="{% url 'edit_comment' comment.id %}" method="POST">
              <input type="hidden" name="csrfmiddlewaretoken" value="{{csrf_token}}">
              <div class="card-body">
                  <textarea name="contents" class="form-control" rows="5">{{comment.contents}}</textarea>
              </div>
              <div class="card-footer text-right">
                  <input type="submit" class="btn btn-success" value="작성하기">
              </div>
          </form>
      </div>
  
  </div>
  {% endblock %}
  ```

  base.html

  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <title>Document</title>
  </head>
  <body>
      <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
          <h5 class="my-0 mr-md-auto font-weight-normal">Instagram</h5>
          
          <a class="btn btn-outline-primary" href="#">Sign up</a>
      </div>
      {% block content %}
      {% endblock %}
      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/62bf9538ca.js" crossorigin="anonymous"></script>
  </body>
  </html>
  ```

  index.html

  ```html
  {% extends 'base.html' %}
  {% block content %}
  <div class="container">
      <div class="card">
          <form action="{% url 'articles' %}" method="POST">
              <!--token은 Post 검사 -->
              <input type="hidden" name="csrfmiddlewaretoken" value="{{csrf_token}}">
              <div class="card-body">
                  <textarea name="contents" class="form-control" rows="5"></textarea>
              </div>
              <div class="card-footer text-right">
                  <input type="submit" class="btn btn-success" value="작성하기">
              </div>
          </form>
      </div>
  
  </div>
  
  <div class="container">
      {% for article in articles %}
      <div class="row mt-4">
          <div class="card col-12">
              <img src="" class="card-img-top">
              <div class="card-body" style="min-height: 9rem;">
                  <p class="card-text">{{article.contents}}</p>
                  <div class="text-right">
                      <a href="{% url 'edit' article.id %}" class="btn btn-warning">수정</a>
                      <a href="{% url 'delete' article.id %}"class="btn btn-danger">삭제</a>
                  </div>
              </div>
  
  
              <ul class="list-group list-group-flush">
                  <li class="list-group-item">
                      <form action="{% url 'comments' %}" method="POST">
                          <input type="hidden" name="csrfmiddlewaretoken" value="{{csrf_token}}">
                          <input type="hidden" name="article_id" value="{{article.id}}">
                          <div class ="row">
                              <!--col 쓰는 이유는 줄여도 어느 정도 맞추기 위해, html 주석에 파이썬 문법 작성 X -->
                              <div class="col-9">
                                  <input type="text" class="form-control" name="contents">
                              </div>
                              <div class="col-3 text-center">
                                  <input type="submit" class="btn btn-primary" value="쓰기">
                              </div>
                          </div>
                        
                      </form>
                  </li>
                  {% for comment in article.comments %}
                  <li class="list-group-item">
                      
                      <i class="fas fa-comment-dots"></i>{{comment.contents}}
                      <span class="float-right">
                          <a href="{% url 'edit_comment' comment.id %}"class="btn btn-warning"><i class="far fa-edit"></i></a>
                          <a href="{% url 'delete_comment' comment.id %}" class="btn btn-danger"><i class="far fa-trash-alt"></i></a>
                      </span>
                  </li>
                  {% endfor %}
                  
              </ul>
          </div>
      </div>
      {% endfor %}
  </div>
  
  {% endblock %}
  ```

  