## 네이버 검색 트랜드 (mvt 패턴)

setting.py

- shell 명령어 

  - 해당 디렉터리로 cd로 이동 

  - python manage.py startapp search_trend ->앱 생성

    | 참고 setting.py에 INSTALLED_APPS에 생성된 앱을 넣어주어야함

    

  - python manage.py runserver -> 서버 실행

```python
"""
Django settings for naverapi project.

Generated by 'django-admin startproject' using Django 2.2.7.

For more information on this file, see
https://docs.djangoproject.com/en/2.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/2.2/ref/settings/
"""

import os

# Build paths inside the project like this: os.path.join(BASE_DIR, ...)
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/2.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = '6g-5v5ov0(72tdo_1*+%p3fk*eo9tx=7q^fv8hddhf)&rvlzk+'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    'search_trend',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'naverapi.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'naverapi.wsgi.application'


# Database
# https://docs.djangoproject.com/en/2.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}


# Password validation
# https://docs.djangoproject.com/en/2.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/2.2/topics/i18n/

LANGUAGE_CODE = 'ko'

TIME_ZONE = 'Asia/Seoul'

#internalization i와 n 사이에 18개가 있다. 
USE_I18N = True

USE_L10N = True

USE_TZ = False

# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/2.2/howto/static-files/

STATIC_URL = '/static/'

```

urls.py (mapping , key-value 형식으로 <key = url 경로 , value = views.py 함수>)

```python
"""naverapi URL Configuration

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/2.2/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path
from search_trend import views as search_trend_view

urlpatterns = [
    
    path('admin/', admin.site.urls),

    #검색어를 입력하는 곳
    path('search/', search_trend_view.search),
    
    #검색어에 대한 트랜드 결과를 받는 곳 
    path('search/result',search_trend_view.result)
]

```

- views.py (함수 설정 및 api 형식 설정)
  - render는 실행될 html 

```python
from django.shortcuts import render
import json
#html 요청을 보내기 위해서 
import requests
# Create your views here.
def search(request):
    #검색어를 입력하는 곳
    return render(request,'search.html')

def result(request):
    #검색어에 대한 검색 트랜드를 받아보는곳
    #request.GET 는 dictionary
    start_date = request.GET['search_start_date']
    end_date = request.GET['search_end_date']
    time_unit = request.GET['search_time_unit']
    group_name = request.GET['search_group_name']
    keywords = request.GET['search_keywords'].split(',')

    

    query = {
        "startDate": start_date,
        "endDate": end_date,
        "timeUnit": time_unit,
        "keywordGroups": [
            {
             "groupName": group_name,
             "keywords": keywords
            }
        ]
    }
    
    url = '네이버 통합 검색어 트렌드 API에서 제공받은 URL'
    client_id ='네이버 통합 검색어 트렌드 API에서 제공받은 id'
    client_secret='네이버 통합 검색어 트렌드 API에서 제공받은 secret 값'

    headers = {
        # 보낼 형식설정
        'Content-Type' : 'application/json',
        'X-Naver-Client-Id' : client_id,
        'X-Naver-Client-Secret' : client_secret
    }

    #dictionary -> json으로 바꿔서 보내기
    params = json.dumps(query)
    
    response = requests.post(url,headers=headers,data = params)

    result = response.text
    context = {
        'result' : result
    }

    return render(request,'result.html', context = context)
```

- 생성한 app (search_trend) 밑에 templates 딕테러리 생성 후 html 담기

  result.html

  ```html
  {{result}}
  ```

  search.html

  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Document</title>
  </head>
  <body>
      <h1>
          검색어를 입력하세요.
      </h1>
      <form action="/search/result">
          <label>기간 시작날짜</label>
          <input type="date" name="search_start_date">
          <br/>
          <label>기간 종료날짜</label>
          <input type="date" name="search_end_date">
          <br/>   
          <label>구간 단위</label>
          <select name="search_time_unit">
              <option value="date">일간</option>
              <option value="week">주간</option>
              <option value="month">월간</option>
          </select>
          <br/> 
          <label>검색어 그룹명</label>
          <input type="text" name="search_group_name">
          <br/>
          <label>트랜드를 볼 검색어 목록(여러개의 검색어의 경우 ','로 구분한다.)</label>
          <input type="text" name="search_keywords">
          <br/>
          <input type="submit" value="트랜드 보기">
      </form>
  </body>
  </html>
  ```

  

##### ORM 사용 

- powershell 명령어

  - python manage.py startapp boards  ->board app 생성
  - setting.py 안 INSTALLED_APPS에 board 추가

- models.py 에 생성할 Table 설정

  ```python
  from django.db import models
  
  # Create your models here.
  class Board(models.Model):
      
      ##컬럼으로 생성(뼈대)
      title = models.CharField(max_length=30)
      contents = models.TextField()
      ##Migration 2번째 생성부터는 Null 체크해줘야함 
      created_by = models.CharField(max_length=10,null=True)
  
      #migration -> python 파일를 DB구조를 만들 준비
      
      ##migrate -> 명렁어
      
      ##DB 반영
  ```

- powershell 명령어

  - python manage.py makemigrations ->migrations DB 구조 만들 준비 생성

  - python manage.py migrate -> 실행

  - python shell로 DB 등록

    - (python shell 사용 방법 및 DB model 사용)

      - python manage.py shell 입력

      - from boards.models import Board 로 불러오기

      - b1 = Board() ->인스턴스 생성 

      -  b1.컬럼명=내용 으로 담기

        - ex)  b1.created_by='Spectre'

      - b1.save() 해서 저장

      - 추출

        - Board.objects.all()  -> 전체 list 추출

        - Board.objects.all()[0] ->indexing도 가능

        - Board.objects.filter(title='오레오 맛있다') -> 특정 부분만 추출(filter 사용) , 이렇게 되면 배열로 나오기 때문에

        - Board.objects.filter(title='오레오 맛있다') [0] -> indexing을 해줘서 가져온다.

        - bb = Board.objects.filter(title='오레오 맛있다')[0]  -> Data 가져와서 담을 수도 있다. 

          - bb = Board.objects.filter(title='오레오 맛있다').first() 와 같음

        - b_all = Board.objects.all() 

          for b in b_all:
          ...     print(b.title)
          ...
          첫번째 제목
          오레오 맛있다           -> 전체를 가져와서 for 문으로 추출

    

- class 생성

  human.py

  ```python
  ##ORM(라이브러리같은 개념) 에서 제공되는 것을 사용 
  ##ORM은 DBMS 까지 접근이 가능 
  ## 즉 SQL없이도 모든 DB 구축이 가능 
  ##jango 안에 ORM 포함
  
  ##class 생성
  ##파일명이랑 Class 이름은 달라도 된다.
  class Human:
      name = 'name'
      age = 'age'
      birth_day = '00-00'
  
      ##인스턴스 함수 생성
      def say_hello(self):
          print("Hi")
  
      def walk(self):
          print("I'm walking")
  ```

  

  greeting.py(human class 사용)

  ```python
  from human import Human
  
  ## 클래스 가져오기
  a = Human()
  a.walk()
  a.say_hello()
  
  ##get 기능
  print(a.name)
  
  ##set 기능 
  a.name="Banana"
  
  print(a.name)
  print(a.age)
  ```

  

  


