### 리눅스

##### RAID 6 와 RAID 1+0 개념

- 페리티를 2개 사용하므로 4개의 하드디스크가 필요하다. 하지만 실무에서는 7~8개 이상의 하드디스크로 구성해야만 어느 정도 효과를 볼 수 있다. 예를 들어 하드디스크 4개로 구성할 때는 공간 효율이 '하드디스크 개수 -2' 이므로 '4-2=2TB' 만 사용할 수 있다. 또 RAID 1+0은 'RAID 1(안전성) + RAID 0 (속도)' 의 개념이라고 설명했다.그래서 공간 효율은 50%가 된다 . RAID 6은 기존 RAID5의 구성과 구현 방법이 거의 동일 하다. 단 하드디스크가 최소 4개이상 필요한 것뿐이다 . RAID 1+0의 구현 방법은 약간 다르다.

  > 패리티가 있으면 어떤 디스크가 깨져도 복구가 가능 !

- 하는 법 :





###### LVM

- 'Logical Volume Manager' , 여러 개의 하드디스크를 합쳐서 한 개의 파티션으로 구성한 후에, 다시 필요에 따라서 나눌 수 있다. 예를 들어 2TB 용량의 하드디스크 2개를 합친 후에 다시 1TB와 3TB로 나눠서 사용 할 수 있다.

- LVM 구성하는 법 - 

  1)  우선 하드디스크 2개를 추가한다. (2GB , 3GB)

  ```bash
$choibogun babo
  ```

  
  
  
  
  > ls -l /dev/sd* 하면 기존 sda와 sdb,sdc를 확인 할 수 있다.
  
  2) fdisk를 설정 (8e 즉 LInux LVM유형으로 )  
  
  - fdisk /dev/sdb -> SCSI 0:1 하드디스크 선택
  - Command : n -> 새로운 파티션 분할
- Select : p -> Primary 파티션 선택
  - Partition number (1-4) : 1 ->파티션 번호 1번 선택
- First sector : (Enter) -> 시작 센터 번호 입력(기본 설정)
  - Last sector : (Enter) -> 마지막 섹터 번호 입력(기본 설정)
- Command : t -> 파일 시스템 유형 선택
  - Hex Code : 8e -> 선택한 파일 시스템 유형 번호 입력 ('L' 을 입력하면 유형 번호가 출력됨)
- Command : p -> 설정된 내용 확인
  - Command : w -> 설정 저장

  

   3) 같은 방식으로 /dev/sdc의 파티션을 나눈다.

  
  
   4) pvcreate을 입력해 물리적인 볼륨을 생성한다.
  
  - 예 ) 'pvcreate /dev/sdb1' , 'pvcreate /dev/sdc1' 
  
    
  
   5) 2개의 물리 볼륨을 하나로 묶자. 즉 , 볼륨 그룹을 생성하는 단계이며 'vgcreate myVG /dev/sdb1 /dev/sdc1' 을 입력한다. 볼륨 그룹 이름을 myVG로 정했다.



​		 6) 'vgdisplay' 명령어를 입력해 볼륨 그룹이 제대로 생성되었는지 확인

> 생성한 myVG 볼륨 그룹은 현재 물리 볼륨(Cur PV)이 2개로 구성되어 있다. 2GB + 3GB = 5GB인 것을 확인 할수 있다.

 		 7) 일반적인 하드디스크의 파티션을 생성할 때는 'fdisk' 명령어를 사용했지만, 볼륨 그룹의 파티션을 생성할 				때는 'lvcreate' 명령어를 사용한다. 논리 그룹을 1GB , 3GB, 1GB로 나누기 위해 명령을 실행하고 확인

​					-  lvcreate --size 1G --name myLG1 myVG        ->myVG 아래 myLG1을 1GB 크기로 생성

​					-  lvcreate --size 3G --name myLG2 myVG 

​					-  lvcreate --extents 100%FREE --name myLG3 myVG    ->나머지 용량을 모두 할당 

​                    -  ls -l /dev/myVG 

​               8) 파일 시스템 생성(포멧)

​					- mkfs.ext4 /dev/myVG/myLG1

​					- mkfs.ext4 /dev/myVG/myLG2

​					- mkfs.ext4 /dev/myVG/myLG3

​				9) 마운트할 디렉토리 생성

​					- mkdir /lvm1 , /lvm2 , /lvm3

​				10) 마운트 실행 

​						- mount /dev/myVG/myLG1 /lvm1

​						- mount /dev/myVG/myLG2 /lvm2

​						- mount /dev/myVG/myLG3 /lvm3

> ​               'df' 명령어로 마운트 확인

​						

​					11) vi /etc/fstab 에 부팅시에도 마운트 적용

​							- 예 ) /dev/myVG/myLG1 /lvm1 ext4 defaults 1 2   

> 즉 ,자신이 가지고 있는 디스크   를 나누고 관리하고 싶을 때 LVM을 사용 



#### RAID에 CentOS 설치하기 

- 지금까지 Server, Server(b), Client를 모두 SCSI 0:0(/dev/sda) 에 설치 했다. 그런데  만약 이 하드 디스크가 고장 난다면 아예 부팅이 안되면서 나머지 추가한 RAID나 LVM을 전혀 사용할 수가 없다. 그래서 이번에는 RAID 1에 CentOS를 설치 한다.

> RAID 1은 하나를 미러링 해서 복제하기 때문에 손상되어도 또다른 디스크에 남아 있어서 복구가 가능하다. 



- 구성하는 법 )

  1) 가상머신을 하나 create 한다. 

  ​    

  | 구분           | RAID 1에 CentOS 설치                                     |
  | -------------- | -------------------------------------------------------- |
  | 가상머신 이름  | RAID1                                                    |
  | 게스트 OS 종류 | CentOS 64-bit                                            |
  | 저장 폴더      | C:\CentOS\RAID1\(공간 여유가 있는 다른 곳을 지정해도 됨) |
  | 메모리 할당    | 2GB                                                      |
  | 하드 디스크    | SCSI 0:0 30GB , SCSI 0:1 30GB                            |
  | CD/DVD         | O                                                        |
  | Audio 장치     | X                                                        |
  | USB 장치       | X                                                        |
  | Floppy 장치    | X                                                        |
  |                |                                                          |

  

​        2)  CentOS 7 ISO 파일(CentOS-7.0-1406-x86_64-DVD.iso) 을 넣고 설치를 진행하자.

​			- [언어 설정]에서 [한국어] 로 지정한다.

​            - [설치 요약] 화면에서 [소프트웨어 선택]을 클릭해서 'GNOME 데스크탑' 을 선택한다. 

​        3) [설치 대상]을 클릭한다.

​        4) [설치 목적지] 에서 2개 하드디스크를 한 번씩 클릭해서 선택한 후 '파티션을 설정합니다' 를 선택하고 <완			료 > 를 클릭한다.

​		5) [수동으로 파티션 설정] 에서 아래쪽의 <+>를 클릭하고, [새 마운트 지점 추가]에서 마운트 지점은 [swap]을 			선택한다. 원하는 용량은 '2GB'를 입력한 후 <마운트 지점 추가> 를 클릭한다.

​		6) [수동으로 파티션 설정]에서 [swap]을 선택하고, 장치 유형을 [RAID]로 선택한 후 RAID 레벨은 [RAID1]을 			선택한 후 <설정 업데이트> 를 클릭한다. 

​		 7) 다시 왼쪽 아래 <+>를 클릭해서 동일한 방식으로 '/' 파티션을 RAID 1으로 구성하자.

​		 8) 왼쪽 위 <완료> 를 클릭하고, [변경요약]의 오른쪽 아래 <변경 사항을 적용>을 클릭한다.

​		 9) 설정이 완료되었으면 <설치 시작>을 클릭한다. 

​		 10) [Root 암호]를 클릭해서 root 사용자의 암호를 'password'로 지정하자.

​		 11) [사용자 생성]을 클릭해서 centos 사용자를 생성하자.		

​		 12) 한동안 설치가 진행되는데, 오른쪽 위 하드디스크 아이콘을 보면 2개가 모두 깜빡거리는 것을 확인할 수 	            있다. 즉, 2개 하드디스크에 RAID 1미러링으로 설치가 진행 중인 상태다. 



​		13) 실행이 되면 터미널에 'mdadm --detail --scan'을 입력해 전체 작동되는 RAID를 확인하자. 